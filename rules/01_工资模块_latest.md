# 01_工资模块（latest）
版本 v2025-09-15R6-HF1
生效：2025-09-15

## 角色与单价
- 组长 300/天；组员 200/天。

## 名词与计薪口径（硬规则）
- 有效施工天：去重后的“施工”日期数（同日多条仅记 1 天；若同日出现“施工/未施工”，以施工优先）。
- 工资天：= 有效施工天；未施工/休息/停工 **不计工资**。
- 未施工天：去重后的“未施工”日期数，仅计餐补，不计工资。
- 工资 = 角色单价 × 工资天。
- 餐补 = 25 × 施工天 + 40 × 未施工天。
- 路补 = 项目制一次性；仅“项目已结束=是”计入；封顶 200/人/项目。

## 计付时点（场景化）
- 场景 A：项目未结束 + 结清离场=是  
  → 当期应付 = 工资 − 预支(限额) + 餐补；路补=0（随项目结束统一结算）。
- 场景 B：项目未结束 + 未离场  
  → 当期应付 = 工资 − 预支(限额)；餐补仅计提不支付；路补=0。
- 场景 C：项目已结束  
  → 当期应付 = 工资 − 预支(限额) + 餐补 + 路补(≤200/人/项目)。

> 预支(限额)：不得超过当期“工资”（不含餐/路），超出部分自动限额并保留提示。

## 强制校验（防呆阻断）
1) 若【工资天 ≠ 施工天】或存在【未施工日期被计入工资】→ **报错并拒绝出数**，并回显冲突日期清单。  
2) 同日多状态冲突 → 以“施工”为准，同日仅记 1 天，并记录处理日志。  
3) 【项目未结束 + 结清离场=是】且餐补未入当期 → **自动修正为当期结清**并黄线提示。  
4) 预支 > 当期工资 → 自动限额并黄线提示。

## 状态词典与同义映射
- 允许值：{施工, 未施工, 休息, 请假, 停工}  
- 同义：施工 ← {干活, 上工, 加班(施工)}；未施工 ← {待命, 备勤, 现场未作业}  
- 白名单外状态 → 黄线预警。

## 出数页首“口径卡片”（固定回显，不可手改）
- 工资天 = **施工天 = __ 天**（未施工工资=0）  
- 餐补 = **25×施工天 + 40×未施工天**（场景：结清离场/未离场/已结束）  
- 路补 = **0 或 项目结束统一结算（≤200/人/项目）**  
- 使用规则 = **v2025-09-15R6-HF1**（RAW 链接）

## 特性开关（兼容上线）
Feature.HardBlock_UnworkToWage = off  
Feature.AutoMealOnCheckout = auto

## 变更记录
- v2025-09-15R6-HF1：新增“工资天=施工天”的硬性阻断与“口径卡片”；明确“项目未结束+结清离场=当期结清餐补”；其余口径不变。
