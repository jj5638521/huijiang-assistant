# 工资出单状态盘点/自检报告

本工具用于回答“改到哪了/哪些改了哪些没改”的问题，只做**状态盘点与选表审计**，不修改计算口径、不影响现有结算结果。

## 已完成项 / 未完成项 / 临时绕行项

- 已完成项
  - 输出当前代码版本、规则版本号、最近提交摘要。
  - 扫描 `data/当前` 数据目录并列出 CSV 概览。
  - 输出运行模式判定（ONLY/项目池/合并表）。
  - 输出选表审计（每个 CSV 的出勤/报销命中与差值分，并标出最终选择或阻断原因）。

- 未完成项
  - 仍需按需补充更多“项目级别盘点信息”（如果后续需要扩展，请新增独立字段，不影响结算逻辑）。

- 临时绕行项（ONLY 双表）
  - 当文件名包含 `ONLY/极简/00_出勤/99_报销` 且仅 2 个 CSV 时，判定为 ONLY/极简双表模式，仍会输出选表审计，但不改变原有结算逻辑。

## 常见阻断码与动作

- A（资料缺失/口令缺失）
  - 现象：`口令.txt` 不存在或 CSV 缺失。
  - 动作：补齐 `data/当前/口令.txt`，并确保 CSV 放入 `data/当前/`。

- S（表头/结构不匹配）
  - 现象：出勤或报销锚点命中不足，无法唯一判定出勤表/报销表。
  - 动作：补齐表头字段（出勤表需含施工日期/是否施工/人员相关列；报销表需含报销日期/金额/类型/状态等）。

- 选表歧义
  - 现象：多个候选得分相同或存在多个合并表候选，无法唯一选择。
  - 动作：只保留 1 出勤 + 1 报销，或仅保留 1 个合并表后重试。

## 常用命令

```bash
python -m tools.demo_settle_person
python -m pytest -q
python -m tools.wage_status
```
