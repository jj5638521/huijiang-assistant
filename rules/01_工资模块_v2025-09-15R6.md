# 工资模块（版本 v2025-09-15R6｜生效：2025-09-15）

固定口径
- 角色单价：组长 300/天；组员 200/天。
- 餐补：施工 25/天；未施工 40/天；清障日餐补=0（仅当日归零，不影响工资）。
- 路补：项目制一次性结算，封顶 200/人/项目；仅当【项目已结束=是】时计入，应付期内累计一次结清。
- 状态优先与去重：同日“施工/未施工”冲突按“施工优先”；同日多条只计 1 天。
- 个人记录合规：两表必传（出勤表+报销表）；“凭证号+日期+金额”唯一；摘要须等于明细；预支≤当期工资上限；应付≥0。

离场/结清（R6 增量）
- 若【结清离场=是】（个人对该项目视同已结束）：
  - 当期结清个人餐补：餐补应结 = 25×施工天 + 40×未施工天 − 清障天（当日餐补=0）。
  - 自离场当期之后，不再为该员工在该项目计提餐补。
  - 路补仍按项目维度：项目未结束→本期路补=0，待项目结束时统一结算。
- 若【结清离场=否】：
  - 项目未结束→餐补仅计提、路补=0；项目已结束→餐补+路补一次性随项目结清。

清算口径（按期出数）
- 工资=角色单价×有效施工天（含“施工优先/同日去重”）。
- 期应付：
  1) 项目未结束 & 结清离场=是（R6）：应付 = 工资 − 已付/预支 + 当期应结餐补（路补=0）。
  2) 项目未结束 & 结清离场=否：应付 = 工资 − 已付/预支（餐补仅计提，路补=0）。
  3) 项目已结束：应付 = 工资 − 已付/预支 + 餐补 + 路补（含前期计提的冲减/结清）。
- 预支与已付：仅统计“状态有效”的记录；可反算预支天数=预支金额/角色单价用于校验。

十重校验（摘要）
1) 资料完整（两表+关键字段）  
2) 周期覆盖与边界  
3) 出勤一致（名单天数 vs 日历最小/最大）  
4) 角色映射与单价  
5) 工资正/反双算（应付+已付=总额）  
6) 餐补口径（施工/未施工/清障/R6 离场）  
7) 已付/预支归集与关键词分类  
8) 凭证唯一 + “摘要=明细”  
9) 路补规则（仅项目结束计入、封顶 200）  
10) 红线与留痕（应付≥0、跨项目隔离、同日去重、审计备注）

模板输出
- 逐条编号 + 日期清单 + 逐步计算；底部打印版本号 v2025-09-15R6 与本次变更说明（R6：离场当期结清个人餐补，路补仍随项目结束结算）。
